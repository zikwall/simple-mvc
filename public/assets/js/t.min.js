/*t.js-0.9;(c)2017 Mntn(r) <https://mn.tn/> c/o Benjamin Lips <g--AT--mn.tn>;MIT Licensed <https://mit-license.org/>;For documentation see https://mntn-dev.github.io/t.js*/
(function(d){d.fn.t=function(y,z){return this.each(function(){var c,n;var a=z;var h=y,b=d(this),q,k=!1,u=-1,r="12qwertyuiop[]asdfghjkl;zxcvbnm,./~!@#$%^&*()_+:1234567890-=op".split([]),e=function(a,b){return d.type(a)[0]==(b||"n")},w=function(){g=d.grep(f,function(a){return"&"==a[0]||!a[1]}).length-1;return-1<g?g:0},t=function(b){u!=b&&a.blink&&(a.blink_perm||l.parent().data("blinking",u=b?1:0))};""===h&&(h="<del>*</del>");if(b.data().is_typing)return"pause"==h&&(b.data("pause",e(a,"b")?oo_=a:b.data("pause")?oo_=!1:oo_=!0),b.data("blinking",oo_?1:0)),this;if("pause"==h)return this;b.data("is_typing",1);e(h,"o")&&(a=h);if(/t\-/.test(b.attr("class")))return this;if("add"==h&&b.data().t){var m=a;a=d.extend(b.data());var l=b=d(":first",b);var x=e(a.typing,"f");m="<"+a.tag+' class="typing-add">'+m+"</"+a.tag+">"}else{"add"==h&&(h=a,a={});a=d.extend({t:!0,delay:!1,speed:75,speed_vary:!1,caret:"\u258e",tag:"span",blink:!1,blink_perm:!1,repeat:-3,pause_on_click:!1,wrap:!1,mistype:!1,locale:"en",init:!1,typing:!1,fin:!1},a?a:b.data());m=n=!1;b.data().t||(b.wrapInner(d("<"+a.tag+"/>",{"class":"t-container",style:"top:auto;bottom:auto;"})),/^[ar]/.test(b.css("position"))||b.css({position:"relative"}),b.css({overflow:"hidden"}));a.wrap&&!b.parent().data().t_wrap&&(b.wrap(d("<div/>",/[.#]/.test(a.wrap[0])?"#"==a.wrap[0]?{id:a.wrap.substr(1)}:{"class":a.wrap.substr(1)}:{style:a.wrap})),b.parent().data("t_wrap",1));e(a.caret,"s")&&!d(".t-caret",b)[0]&&(!0===a.blink&&(a.blink=200),e(a.blink)&&50>a.blink&&(a.blink=50),!e(a.blink)&&(a.blink=!1),n=d("<"+a.tag+"/>",{"class":"t-caret",html:a.caret}).appendTo(b),a.blink&&b.append("\u200b")&&b.data("bi",setInterval(function(){(l.parent().data().blinking|(v="h"==n.css("visibility")[0])||a.blink_perm)&&n.css({visibility:v?"visible":"hidden"})},e(a.blink)?a.blink:a.speed*(a.speed_vary?4:5))));a.blink||b.data().bi&&clearInterval(b.data().bi)&&b.removeData("bi");!e(a.blink_perm,"b")&&(a.blink_perm=!0);a.speed=!e(a.speed)||10>a.speed?10:a.speed;a.speed_vary&&(a.speed/=2.5);1<a.mistype||(a.mistype=!1);b.data(a);d(".typing-0",b).replaceWith(function(){return this.childNodes});d(".typing-add",b).remove();l=b=d(":first",b);var f=e(h,"s")?h:b.html();""==f&&(f="\u200b");b.empty();l.parent().show().css({visibility:"visible"});e(a.delay)&&0<a.delay&&(c=~~(1E3*a.delay/a.speed))&&a.blink_perm||b.parent().data("blinking",1);x=e(a.typing,"f");!0===a.pause_on_click&&b.parent().off("click").click(function(a){"1"!=d(a.target).data().click&&d(this).t("pause")})}/<kbd.*?>/i.test(f=String(m||f))&&b.parent().data("kbd",j_=1)&&b.parent().data("mistype",b.parent().data("mistype")?_j=b.parent().data().mistype:_j=10)&&(a.mistype=_j)&&(a.kbd=j_?j_:!1);f=f.replace(/(.*?)[\u200b]+$/,"$1").replace(/<\!\-\-([\s\S]+?)\-\->/g,"$1").replace(/<ins>([^0-9])<\/ins>/g,"$1").replace(/<(embed|command|col|wbr|img|br|input|hr)(.*?)[\/]?>/g,"<#$1$2/>").replace(/<ins>\s*(\d*[.]?\d*)\s*(<\/ins>)/g,'<ins data-ins="$1"></ins>').replace(/<ins(.*?)>([\s\S]*?)(<\/ins>)/g,function(a,b,c){return"<#ins"+b+">"+c.replace(/<(?!#)/g,"<#")+"<#/ins>"+(c?"":"</ins>")}).replace(/<(del.*?data-del=")(.*?)(".*?)><\/(del>)/g,"<#$1$2$3><#/$4$2</$4").replace(/<del(.*?)>([\s\S]*?)<\/del>/g,function(a,b,c,d){s=(s=c.match(/<s>\s*(.*?)\s*<\/s>/i))&&s[0]?' data-s="'+(s[1]||"1")+'"':"";i=(i=c.match(/data-ins=\"(.*?)\"/))&&i[1]?i[1]:""==s?.25:.75;c=c.replace(/(<s>.*?<\/s>|<[\/]?.*?>)/g,"");return"<del"+b+s+' data-del="'+c.replace(/\n/,"\\n")+'" data-ins="'+i+'">'+("*"!=c?c:"")+"</del>"}).replace(/<(\w+)(.*?)>/g,"<$1$2><#/$1>").replace(/<\/(\w+)>/g,"</> ($1)").replace(/<[#]+/g,"<").replace(/(\/del>)\*</g,"$1<").match(/<ins.*?>[\s\S]*?<\/ins>|<[^<]+\/>|<\/> \(\w+\)|<[\s\S]+?><\/\w+>|&[#x]?[a-z0-9]+;|\r|\n|\t|\S|\s/ig);!e(c)&&(c=f.shift());f.push("\u200b");"de"==a.locale&&(r='12qwertzuiop\u00fc+asdfghjkl\u00f6\u00e4#<yxcvbnm,.-!"\u00a7$%&/(()=?1234567890\u00df*p+');var A=w()+1;!m&&e(a.init,"f")&&a.init(l.parent());var B=setInterval(function(){if(!l.parent().data("pause")&&!k){k=!k;if(e(c)){if(0<--c){k=!k;t(.25>=b.data().ins?0:1);return}c=b.data().ins?"</>":f.shift()}else if(a.speed_vary&&~~(4*Math.random())){k=!k;return}t(0);if(b.data().del&&(b.data().s&&!c[0]&&b.text(""),q=String(b.data().del),!e(c,"a")&&"/"==c[1]&&(c=q.replace(/\\n/g,"\n").split([])),e(c,"a"))){if(p=c.pop()){b.data().s?b.html(c.join([])+"<mark "+("."==(_=String(b.data().s))[0]?'class="'+_.substr(1)+'"':'style="background:'+("1"==_?"yellow":_.split(",")[0])+((_=_.split(",")[1])?";color:"+_:"")+';"')+">"+b.data().del.substr(c.length)+"</mark>"):b.text(c.join([]));k=!k;return}"*"==q&&(l.wrapInner(d("<"+a.tag+"/>",{"class":"typing-0",style:"display:none;"})),b=b.parent(),m&&(f=d.merge(["<"+a.tag+' class="typing-add"></'+a.tag+">"],f,["</"+a.tag+">"]),b=b.parent()));b=b.parent();"\u200b"==q&&b.find(":last").remove();c=""}for(;"/"==c[1];)b=b.parent(),c=f.shift()||"";for(;;)if(b.append(c),x&&a.typing(l.parent(),c,w(),A),!/<ins.*?>[\s\S]+</.test(c)&&/></.test(c)&&(b=b.find(":last")),f[0]&&/<\w+/.test(f[0]))c=f.shift();else break;(c=f.shift())?((a.mistype&&!a.kbd||a.kbd&&/kbd/i.test(b.prop("tagName")))&&c&&!c[1]&&"\u200b"!=b.data().del&&" "!=c&&!~~(Math.random()*a.mistype)&&-1<(__=d.inArray(c.toLowerCase(),r,2))&&(__+=~~(2*Math.random())+1,~~(2*Math.random())&&(__-=3),f=d.merge([90>c.charCodeAt(0)?r[__].toUpperCase():r[__],"</del>",c],f),c='<del data-ins=".25" data-del="\u200b"></del>'),c&&"/"==c[1]&&b.data().ins&&(c=~~(1E3*Number(b.data().ins)/a.speed)),k=!k):(clearInterval(B),l.parent().removeData(["is_typing","pause"]),e(a.repeat)&&--a.repeat,-1<a.repeat?(a.init=!1,l.parent().t(e(h,"o")?a:h,a)):(t(1),e(a.fin,"f")&&a.fin(l.parent())))}},a.speed)})}})(jQuery);
